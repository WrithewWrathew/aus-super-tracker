<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AusSuper Auto-Tracker (CORS Proxy)</title>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; max-width: 600px; margin: auto; background: #f5f5f5; text-align: center; }
  #output { font-size: 3em; margin: 30px 0; padding: 30px; background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
  button { padding: 15px 30px; font-size: 1.2em; background: #0078d4; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px; }
  button:hover { background: #106ebe; }
  .status { font-size: 1.1em; color: #666; margin: 10px 0; }
</style>
</head>
<body>

<h1>ü§ë AusSuper International Shares</h1>
<div class="status" id="status">Loading...</div>
<div id="output">-</div>
<button id="refreshBtn">üîÑ Refresh</button>

<script>
const PROXY_URL = 'https://api.allorigins.win/raw?url=';
const API_URL = encodeURIComponent('https://www.australiansuper.com//api/graphs/dailyrates/download/?start=01/02/2026&end=08/02/2026&cumulative=False&superType=super&truncateDecimalPlaces=True&outputFilename=temp.csv');

async function fetchData() {
  const status = document.getElementById("status");
  status.textContent = "Fetching via proxy...";
  
  try {
    const response = await fetch(PROXY_URL + API_URL);
    const csvText = await response.text();
    
    const rows = csvText.replace(/\r\n?/g, '\n').trim().split('\n');
    const headers = rows[0].split(',').map(h => h.trim());
    const intlIndex = headers.indexOf("International Shares");
    
    if (intlIndex === -1) throw new Error("Column not found");
    
    // Find last row with real data
    let intlValue = null;
    for (let i = rows.length - 1; i > 0; i--) {
      const cols = rows[i].split(',').map(c => c.trim());
      if (cols.length > intlIndex) {
        const value = parseFloat(cols[intlIndex]);
        const hasData = cols.slice(1).some(c => {
          const num = parseFloat(c);
          return !isNaN(num) && num !== 0;
        });
        if (hasData) {
          intlValue = value;
          break;
        }
      }
    }
    
    const output = document.getElementById("output");
    if (intlValue === null || intlValue === 0) {
      output.textContent = "Currently no change.";
      output.style.color = '#666';
    } else {
      output.textContent = intlValue.toFixed(2) + '%';
      output.style.color = intlValue >= 0 ? '#00aa00' : '#cc0000';
    }
    
    status.textContent = "‚úÖ Updated";
    
  } catch (error) {
    document.getElementById("status").textContent = "‚ùå Proxy failed - " + error.message;
    document.getElementById("output").textContent = "Error";
  }
}

// Auto-run + refresh button
fetchData();
document.getElementById("refreshBtn").addEventListener("click", fetchData);
</script>

</body>
</html>
