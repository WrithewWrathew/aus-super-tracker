<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AusSuper International Shares (Text Search)</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 40px; 
    max-width: 600px; 
    margin: auto; 
    background: #f5f5f5; 
    text-align: center; 
  }
  #output { 
    font-size: 3.5em; 
    margin: 30px 0; 
    padding: 40px; 
    background: white; 
    border-radius: 20px; 
    box-shadow: 0 6px 30px rgba(0,0,0,0.15); 
    font-weight: bold;
  }
  button { 
    padding: 15px 35px; 
    font-size: 1.3em; 
    background: #0078d4; 
    color: white; 
    border: none; 
    border-radius: 10px; 
    cursor: pointer; 
    margin: 10px; 
  }
  button:hover { background: #106ebe; }
  .status { 
    font-size: 1.2em; 
    color: #666; 
    margin: 15px 0; 
  }
  #debug { 
    font-size: 0.8em; 
    color: #888; 
    background: #f0f0f0; 
    padding: 10px; 
    border-radius: 5px; 
    margin: 10px 0;
    max-height: 100px;
    overflow-y: auto;
  }
</style>
</head>
<body>

<h1>ü§ë AusSuper International Shares</h1>
<div class="status" id="status">Loading...</div>
<div id="output">‚è≥</div>
<div id="debug"></div>
<button id="refreshBtn">üîÑ Refresh</button>

<script>
const TARGET_URL = 'https://www.australiansuper.com/why-choose-us/our-performance?superType=Super&display=table';

async function scrapeData() {
  const status = document.getElementById('status');
  const output = document.getElementById('output');
  const debug = document.getElementById('debug');
  
  status.textContent = 'Searching for International Shares row...';
  output.textContent = '‚è≥';
  debug.textContent = '';
  
  try {
    // Fetch via CORS proxy
    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(TARGET_URL);
    const response = await fetch(proxyUrl);
    const html = await response.text();
    
    // SEARCH for the exact marker
    const marker = 'diy-mixed-investment-choice">International Shares</a></th>';
    const markerIndex = html.indexOf(marker);
    
    if (markerIndex === -1) {
      throw new Error('International Shares marker not found');
    }
    
    debug.textContent = `‚úÖ Found marker at position ${markerIndex}`;
    
    // Find the START of the <tr> (go backwards from marker)
    let trStart = html.lastIndexOf('<tr', markerIndex);
    let trEnd = html.indexOf('</tr>', markerIndex);
    
    if (trStart === -1 || trEnd === -1) {
      throw new Error('TR tags not found');
    }
    
    // Extract the entire row
    const rowHtml = html.substring(trStart, trEnd + 5);
    debug.textContent += `\n\nROW HTML:\n${rowHtml.substring(0, 300)}...`;
    
    // Extract ALL percentages from the row (everything with % sign)
    const percentMatches = rowHtml.match(/-?\d+\.?\d*%+/g) || [];
    debug.textContent += `\n\nFOUND PERCENTS:\n${percentMatches.join('\n')}`;
    
    // Find LAST non-zero percentage
    let lastNonZero = null;
    for (let i = percentMatches.length - 1; i >= 0; i--) {
      const pctStr = percentMatches[i].replace('%', '');
      const value = parseFloat(pctStr);
      
      if (!isNaN(value) && Math.abs(value) > 0.0001) {
        lastNonZero = value;
        debug.textContent += `\n‚úÖ LAST NON-ZERO: ${pctStr}%`;
        break;
      }
    }
    
    if (lastNonZero === null) {
      output.textContent = 'Currently no change.';
      output.style.color = '#666';
      status.textContent = '‚úÖ All zeros in row';
    } else {
      const displayPct = lastNonZero.toFixed(4);
      output.textContent = `${displayPct}%`;
      output.style.color = lastNonZero >= 0 ? '#00aa44' : '#cc0000';
      status.textContent = `‚úÖ Latest move: ${lastNonZero >= 0 ? '‚Üë' : '‚Üì'}${Math.abs(lastNonZero).toFixed(4)}%`;
    }
    
  } catch (error) {
    status.textContent = `‚ùå ${error.message}`;
    output.textContent = 'Failed';
    output.style.color = '#cc0000';
    debug.textContent += `\nERROR: ${error.message}`;
  }
}

// Auto-run
scrapeData();
document.getElementById('refreshBtn').addEventListener('click', scrapeData);
</script>

</body>
</html>
