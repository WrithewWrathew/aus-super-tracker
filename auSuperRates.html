<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AusSuper International Shares (CSV Auto-Refresh)</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 40px; 
    max-width: 600px; 
    margin: auto; 
    background: #f5f5f5; 
    text-align: center; 
  }
  #output { 
    font-size: 3.5em; 
    margin: 30px 0; 
    padding: 40px; 
    background: white; 
    border-radius: 20px; 
    box-shadow: 0 6px 30px rgba(0,0,0,0.15); 
    font-weight: bold;
  }
  button { 
    padding: 15px 35px; 
    font-size: 1.3em; 
    background: #0078d4; 
    color: white; 
    border: none; 
    border-radius: 10px; 
    cursor: pointer; 
    margin: 10px; 
  }
  button:hover { background: #106ebe; }
  .status { font-size: 1.2em; color: #666; margin: 15px 0; }
  .instructions { 
    background: #e7f3ff; 
    padding: 20px; 
    border-radius: 10px; 
    margin: 20px 0; 
    font-size: 1.1em;
  }
  input[type="file"] { 
    margin: 20px 0; 
    padding: 10px; 
    font-size: 1.1em;
  }
</style>
</head>
<body>

<h1>ü§ë AusSuper International Shares</h1>

<div class="instructions">
  <strong>üì• Step 1:</strong> Download fresh <a href="https://www.australiansuper.com//api/graphs/dailyrates/download/?start=01/02/2026&end=08/02/2026&cumulative=False&superType=super&truncateDecimalPlaces=True&outputFilename=temp.csv" target="_blank">temp.csv</a><br>
  <strong>üìÇ Step 2:</strong> Click "Load CSV" below ‚Üí **Auto-refreshes every 5 minutes!**
</div>

<input type="file" id="fileInput" accept=".csv">
<div class="status" id="status">Upload temp.csv to start tracking</div>
<div id="output">‚è≥</div>
<button id="refreshBtn" disabled>üîÑ Re-Scan Same File</button>
<div id="lastUpdated"></div>

<script>
let lastFile = null;
let refreshInterval = null;

function processCsv(text) {
  const output = document.getElementById('output');
  const status = document.getElementById('status');
  const lastUpdated = document.getElementById('lastUpdated');
  
  const rows = text.replace(/\r\n?/g, '\n').trim().split('\n');
  if (rows.length < 2) {
    output.textContent = 'No data in CSV';
    return;
  }
  
  const headers = rows[0].split(',').map(h => h.trim());
  const intlIndex = headers.indexOf('International Shares');
  
  if (intlIndex === -1) {
    output.textContent = 'International Shares column missing';
    return;
  }
  
  // Find LAST row with NON-ZERO data
  let lastIntlValue = null;
  for (let i = rows.length - 1; i > 0; i--) {
    const cols = rows[i].split(',').map(c => c.trim());
    if (cols.length > intlIndex) {
      const intlValue = parseFloat(cols[intlIndex]);
      const hasRealData = cols.slice(1).some(c => {
        const num = parseFloat(c);
        return !isNaN(num) && Math.abs(num) > 0.0001;
      });
      
      if (hasRealData) {
        lastIntlValue = intlValue;
        break;
      }
    }
  }
  
  lastUpdated.textContent = `Last checked: ${new Date().toLocaleTimeString()}`;
  
  if (lastIntlValue === null || Math.abs(lastIntlValue) < 0.0001) {
    output.textContent = 'Currently no change.';
    output.style.color = '#666';
    status.textContent = '‚úÖ No recent movement detected';
  } else {
    const pct = lastIntlValue.toFixed(4);
    output.textContent = `${pct}%`;
    output.style.color = lastIntlValue >= 0 ? '#00aa44' : '#cc0000';
    status.textContent = `‚úÖ Latest: ${lastIntlValue >= 0 ? '‚Üë' : '‚Üì'}${Math.abs(lastIntlValue).toFixed(4)}%`;
  }
}

function readFile(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    processCsv(e.target.result);
    document.getElementById('refreshBtn').disabled = false;
  };
  reader.readAsText(file);
}

document.getElementById('fileInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) {
    lastFile = file;
    
    // Clear previous auto-refresh
    if (refreshInterval) clearInterval(refreshInterval);
    
    // Start 5-minute auto-refresh
    readFile(file);
    refreshInterval = setInterval(() => readFile(lastFile), 5 * 60 * 1000);
    
    document.getElementById('status').textContent = '‚úÖ Auto-refresh every 5 min';
  }
});

document.getElementById('refreshBtn').addEventListener('click', () => {
  if (lastFile) readFile(lastFile);
});
</script>

</body>
</html>
