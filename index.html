<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AustralianSuper CSV Viewer</title>
<style>
  body { font-family: Arial; margin: 20px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
  th { background: #f4f4f4; }
  #loading { font-weight: bold; margin-bottom: 10px; }
  button { margin-bottom: 10px; padding: 6px 12px; }
</style>
</head>
<body>

<h2>AustralianSuper Daily Rates CSV</h2>
<div id="loading"></div>
<button onclick="loadCSV()">Refresh</button>
<div id="tableContainer"></div>

<script>
async function loadCSV() {
  const loading = document.getElementById("loading");
  const container = document.getElementById("tableContainer");
  container.innerHTML = "";
  loading.innerText = "Fetching CSV... please wait 3-5 seconds";

  try {
    const res = await fetch("/api/fetchCsv");
    if (!res.ok) throw new Error("Failed to fetch CSV: " + res.status);

    const text = await res.text();

    loading.innerText = "";

    // Convert CSV to array
    const rows = text.split("\n").map(r => r.trim()).filter(r => r);
    if (rows.length === 0) {
      container.innerText = "No data found";
      return;
    }

    // Build HTML table
    const table = document.createElement("table");

    rows.forEach((row, i) => {
      const tr = document.createElement("tr");
      const cols = row.split(",").map(c => c.trim());
      cols.forEach(col => {
        const cell = i === 0 ? document.createElement("th") : document.createElement("td");
        cell.innerText = col;
        tr.appendChild(cell);
      });
      table.appendChild(tr);
    });

    container.appendChild(table);

  } catch (err) {
    loading.innerText = "Error fetching CSV: " + err.message;
    console.error(err);
  }
}

// Initial load
loadCSV();
</script>

</body>
</html>
